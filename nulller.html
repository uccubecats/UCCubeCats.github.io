<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solar PCB 3D Viewer</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        }
        
        canvas {
            display: block;
            width: 100%;
            height: 100vh;
        }
        
        #info {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            background: rgba(0, 0, 0, 0.6);
            padding: 15px 20px;
            border-radius: 8px;
            font-size: 14px;
            z-index: 100;
        }
        
        #info h2 {
            margin: 0 0 10px 0;
            font-size: 18px;
        }
        
        #info p {
            margin: 5px 0;
        }
        
        #loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 24px;
            background: rgba(0, 0, 0, 0.7);
            padding: 30px 50px;
            border-radius: 10px;
            z-index: 200;
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div id="loading">Loading 3D Model...</div>
    
    <div id="info">
        <h2>üîÜ Back Solar PCB</h2>
        <p><strong>Controls:</strong></p>
        <p>üñ±Ô∏è Left Click + Drag: Rotate</p>
        <p>üñ±Ô∏è Right Click + Drag: Pan</p>
        <p>üñ±Ô∏è Scroll: Zoom</p>
    </div>

    <!-- Three.js Core -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <!-- OrbitControls -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    
    <!-- STLLoader -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/STLLoader.js"></script>

    <script>
        // Scene setup
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x1a1a2e);
        
        // Camera setup
        const camera = new THREE.PerspectiveCamera(
            75,
            window.innerWidth / window.innerHeight,
            0.1,
            1000
        );
        camera.position.set(100, 100, 100);
        
        // Renderer setup
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        document.body.appendChild(renderer.domElement);
        
        // OrbitControls for camera manipulation
        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;
        controls.screenSpacePanning = false;
        controls.minDistance = 10;
        controls.maxDistance = 500;
        
        // Lighting setup
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);
        
        const directionalLight1 = new THREE.DirectionalLight(0xffffff, 0.8);
        directionalLight1.position.set(100, 100, 50);
        directionalLight1.castShadow = true;
        scene.add(directionalLight1);
        
        const directionalLight2 = new THREE.DirectionalLight(0xffffff, 0.5);
        directionalLight2.position.set(-100, -100, -50);
        scene.add(directionalLight2);
        
        const hemisphereLight = new THREE.HemisphereLight(0xffffff, 0x444444, 0.4);
        scene.add(hemisphereLight);
        
        
        // Axes helper for orientation
        const axesHelper = new THREE.AxesHelper(50);
        scene.add(axesHelper);
        
        // Load STL model
        const loader = new THREE.STLLoader();
        const loadingElement = document.getElementById('loading');
        
        loader.load(
            './3DModel/Back_Solar_PCB.stl',
            function (geometry) {
                // Create material for the model
                const material = new THREE.MeshPhongMaterial({
                    color: 0x100e90,
                    emissive: 0x000000,
                    specular: 0xffffff,
                    shininess: 0,
                    flatShading: true,
                    side: THREE.FrontSide,
                    wireframe: false,
                    transparent: false
                });
                
                // Create mesh with material
                const mesh = new THREE.Mesh(geometry, material);
                
                // Center the geometry
                geometry.computeBoundingBox();
                const center = new THREE.Vector3();
                geometry.boundingBox.getCenter(center);
                geometry.translate(-center.x, -center.y, -center.z);
                
                // Rotate mesh to face upward
                mesh.rotation.y = Math.PI ; 
                mesh.rotation.x = Math.PI /2; 
                // Add mesh to scene
                mesh.castShadow = true;
                mesh.receiveShadow = true;
                scene.add(mesh);
                
                // Adjust camera to fit the model
                const box = new THREE.Box3().setFromObject(mesh);
                const size = box.getSize(new THREE.Vector3());
                const maxDim = Math.max(size.x, size.y, size.z);
                const fov = camera.fov * (Math.PI / 180);
                let cameraZ = Math.abs(maxDim / 2 / Math.tan(fov / 2));
                cameraZ *= 2; // Add some padding
                
                camera.position.set(0, cameraZ, cameraZ);
                camera.lookAt(0, 0, 0);
                controls.target.set(0, 0, 0);
                controls.update();
                
                // Hide loading message
                loadingElement.classList.add('hidden');
                
                console.log('STL model loaded successfully!');
                console.log('Model dimensions:', size);
            },
            function (xhr) {
                // Progress callback
                const percentComplete = (xhr.loaded / xhr.total) * 100;
                loadingElement.textContent = `Loading 3D Model... ${Math.round(percentComplete)}%`;
            },
            function (error) {
                // Error callback
                console.error('Error loading STL file:', error);
                loadingElement.innerHTML = `
                    <div style="color: #ff6b6b;">
                        <strong>Error Loading Model</strong><br>
                        Please ensure the file exists at:<br>
                        <code>./3DModel/Back_Solar_PCB.stl</code>
                    </div>
                `;
            }
        );
        
        // Animation loop
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
        animate();
        
        // Handle window resize
        window.addEventListener('resize', function() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
        
        // Optional: Add rotation animation (uncomment to enable)
        // function rotateModel() {
        //     scene.children.forEach(child => {
        //         if (child instanceof THREE.Mesh && child.geometry.type === 'BufferGeometry') {
        //             child.rotation.y += 0.005;
        //         }
        //     });
        // }
        // setInterval(rotateModel, 16);
    </script>
</body>
</html>